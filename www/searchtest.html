</head>
<style>


</style>

<body>
<script>

//INFORMATION TABLE UPDATER
		function displayInfo(str){
			
			var table = document.getElementById("info");
			//Clear all but the header row
			/*for(var i=1; i <= table.rows.length; i++){
				table.deleteRow(0);
			}*/
			var xmlhttp = new XMLHttpRequest();
			
			xmlhttp.onreadystatechange = function(){

				if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
				
					var obj = JSON.parse(xmlhttp.responseText);
					//insert a row after the header row (i.e. after the first row)
					var row = table.insertRow(1);
					row.insertCell(0).innerHTML = obj.Info[0].firstname + " " + obj.Info[0].lastname;
					row.insertCell(1).innerHTML = obj.Info[0].visitor_netid;
					
					//construct Abilities table
					if(obj.Abilities.length == 0){
						abilitiesTableString = "No Abilities on Record";
					} else {
						abilitiesTableString = "<table width=100% border=\"0\" cellpadding=\"5\">";
						
						abilitiesTableString += "<tr><th>Ability</th><th>Facility</th><th>Date</th><th>Note</th></tr>";
						//Insert all ability rows after header row
						for(r = 0; r < obj.Abilities.length; r++){
							
							abilitiesTableString += "<tr><td>" + obj.Abilities[r].ability + "</td><td>" + obj.Abilities[r].facility + "</td><td>" + obj.Abilities[r].date + "</td><td>" + obj.Abilities[r].note + "</td></tr>";
							
						}
					}
					row.insertCell(2).innerHTML = abilitiesTableString;
				
				}
			};
				
			xmlhttp.open("GET", "getVisitorInfo.php?q=" + str, true);
			xmlhttp.send();
				
		}


		//SEARCH TABLE UPDATER
		function showVisitors(str){
		
		
		
			var table = document.getElementById("possVisitors");
			//clear the table to remove old results and indicators
			for(var i=0; i <= table.rows.length; i++){
				table.deleteRow(0);
			}table.insertRow(0).insertCell(0).innerHTML = "";
			
			//Indicate request is being processed during response time
			table.insertRow(0).insertCell(0).innerHTML = "Processing";
				
			if(str.length == 0){
				//Clear the table to prevent indicator stacking
				for(var i=0; i <= table.rows.length; i++){
				table.deleteRow(0);
				}table.insertRow(0).insertCell(0).innerHTML = "";
				//Indicate the function of the text box to the user
				table.insertRow(0).insertCell(0).innerHTML = "Type to Search";
				return;
			} else {
				
				var xmlhttp = new XMLHttpRequest();
				
				xmlhttp.onreadystatechange = function(){

					if(xmlhttp.readyState == 3 && xmlhttp.status == 200){
						//clear table to prevent result stacking
						for(var i=0; i <= table.rows.length; i++){
							table.deleteRow(0);
						}table.insertRow(0).insertCell(0).innerHTML = "";
						
						var obj = JSON.parse(xmlhttp.responseText);
						
						if(obj.Visitors.length == 0){
							table.insertRow(0).insertCell(0).innerHTML = "No Such Visitor In The Database";
						} else{
							for(var j=0; j < obj.Visitors.length; j++){
								var visinfo = obj.Visitors[j].visitor_netid + " -- " + obj.Visitors[j].firstname + " " + obj.Visitors[j].lastname;
								var vislink = " <a onClick=\"displayInfo('"+obj.Visitors[j].visitor_netid+"');\" href=\"#\">Select</a>";
								table.insertRow(0).insertCell(0).innerHTML = visinfo + vislink;
								
							}
						}
					}
				};
				
				xmlhttp.open("GET", "getpossVisitors.php?q=" + str, true);
				xmlhttp.send();
			}
		}
		
		
		
		
			
</script>


<div id="something">
Search by Visitor NetID or Name: 
<form>
	<input type = "text" onkeyup="showVisitors(this.value)"><br />

	<table id="possVisitors">
	<tr>
		<td>Type to Search</td>
	</tr>
	</table>
</form><br />

<table id="info" width="100%" border="1" cellpadding="10">
	<tr>
		<th width=15%>Visitor Name</th>
		<th width=15%>Visitor NetID</th>
		<th>Abilities</th>
	</tr>
</table>
</div>

</body>
</html>
